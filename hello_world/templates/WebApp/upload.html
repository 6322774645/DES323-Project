{% extends 'WebApp/layout/layout_main.html' %}

{% block title %}
Main Page
{% endblock %}

{% block content %}
    <h1>Upload A File</h1>
    {% for uid in filter_type %}
    <div class="download-container">
        <form action="" method="post" >
            {% csrf_token %}
            <div class="file-upload" id="file-upload">
                <input type="file" name="files" id="files" accept="" />
                <p>Drag & Drop .txt File Or Click To Select A .txt File</p>
            </div>
            <button button type="button" class="btn btn-danger btn-rounded"  onclick="UploadFile({{ filter_type  }});" style="margin:5px;">Upload</button>
        </form>
    </div>
    {% endfor %}
    <script>
        // Get references to the HTML elements
        const fileInput = document.getElementById("fileInput");
        const fileUpload = document.getElementById("file-upload");
    
        // Prevent the default behavior of the browser when a file is dragged over the drop area
        fileUpload.addEventListener("dragover", (e) => {
            e.preventDefault();
            fileUpload.classList.add("dragover");
        });
    
        // Restore the default styles when the file is dragged out of the drop area
        fileUpload.addEventListener("dragleave", () => {
            fileUpload.classList.remove("dragover");
        });
    
        // Handle the file drop event
        fileUpload.addEventListener("drop", (e) => {
            e.preventDefault();
            fileUpload.classList.remove("dragover");
    
            const droppedFile = e.dataTransfer.files[0];
    
            // Check if the dropped file has a .txt extension
            if (droppedFile.name.endsWith(".txt")) {
                fileInput.files = e.dataTransfer.files;
                fileInput.value = droppedFile.name;
            } else {
                alert("Only .txt files are allowed for upload.");
            }
        });
    
        // Handle the file input change event
        fileInput.addEventListener("change", () => {
            const selectedFile = fileInput.files[0];
            if (selectedFile) {
                fileUpload.classList.remove("dragover");
            }
        });

        function UploadFile(uid) {
            console.log("File uploaded");
            console.log("UID:",uid);
            // Create anchor element. 
            var a = document.createElement('a');  
                    
            // Create the text node for anchor element. 
            var link = "/application/files/add/"+uid; 
                        
            window.location.href = link;
        }
    </script>
{% endblock %}